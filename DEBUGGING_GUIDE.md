# èª¿è©¦æŒ‡å—

æœ¬æŒ‡å—å¹«åŠ©æ‚¨èª¿è©¦ OpenAI Realtime API é€£æ¥å•é¡Œã€‚

## æ”¹é€²çš„æ—¥èªŒè¨˜éŒ„

### å‰ç«¯æ—¥èªŒï¼ˆç€è¦½å™¨æ§åˆ¶å°ï¼‰

ç¾åœ¨æœƒé¡¯ç¤ºæ›´è©³ç´°çš„æ—¥èªŒï¼š

- âœ… `OpenAI Realtime API WebSocket connected` - é€£æ¥æˆåŠŸ
- ğŸ“¤ `Sending session.update` - ç™¼é€æœƒè©±é…ç½®
- ğŸ“¥ `OpenAI response:` - æ”¶åˆ°å›æ‡‰
- ğŸ“¨ `OpenAI message:` - æ”¶åˆ°å…¶ä»–è¨Šæ¯
- âŒ `OpenAI error message received` - æ”¶åˆ°éŒ¯èª¤
- ğŸ¤ `Sending audio chunk` - ç™¼é€éŸ³è¨Šæ•¸æ“š
- ğŸ“¤ `Triggering response generation` - è§¸ç™¼å›æ‡‰ç”Ÿæˆ

### å¾Œç«¯æ—¥èªŒï¼ˆçµ‚ç«¯æ©Ÿï¼‰

å¾Œç«¯ä¼ºæœå™¨ç¾åœ¨æœƒé¡¯ç¤ºï¼š

- ğŸ”— `Connecting to OpenAI Realtime API...` - é–‹å§‹é€£æ¥
- âœ… `Backend: Connected to OpenAI Realtime API` - é€£æ¥æˆåŠŸ
- âœ… `Backend: session.created` - æœƒè©±å‰µå»ºæˆåŠŸ
- âŒ `Backend: OpenAI error:` - OpenAI éŒ¯èª¤è©³æƒ…
- âš ï¸ `Backend: OpenAI WebSocket closed` - é€£æ¥é—œé–‰

## èª¿è©¦æ­¥é©Ÿ

### 1. æª¢æŸ¥é€£æ¥æµç¨‹

1. **å•Ÿå‹•å¾Œç«¯ä¼ºæœå™¨**ï¼š
   ```bash
   npm run server
   ```
   æ‡‰è©²çœ‹åˆ°ï¼š
   ```
   Server running on http://localhost:3001
   WebSocket proxy available at ws://localhost:3001/api/openai-realtime
   ```

2. **æ‰“é–‹ç€è¦½å™¨æ§åˆ¶å°**ï¼ˆF12 æˆ– Cmd+Option+Iï¼‰

3. **é»æ“Šã€ŒStart Conversationã€**

4. **è§€å¯Ÿæ—¥èªŒé †åº**ï¼š
   - æ‡‰è©²çœ‹åˆ°ï¼š`Connecting to OpenAI Realtime API via backend proxy...`
   - ç„¶å¾Œï¼š`âœ… OpenAI Realtime API WebSocket connected`
   - ç„¶å¾Œï¼š`ğŸ“¤ Sending session.update`
   - ç„¶å¾Œï¼š`âœ… Session created successfully` æˆ– `âŒ OpenAI error`

### 2. æª¢æŸ¥éŒ¯èª¤è©³æƒ…

å¦‚æœçœ‹åˆ°éŒ¯èª¤ï¼Œå±•é–‹éŒ¯èª¤ç‰©ä»¶æŸ¥çœ‹ï¼š
- `type`: éŒ¯èª¤é¡å‹
- `message`: éŒ¯èª¤è¨Šæ¯
- `code`: éŒ¯èª¤ä»£ç¢¼
- `param`: ç›¸é—œåƒæ•¸

### 3. æª¢æŸ¥éŸ³è¨Šç™¼é€

ç•¶æ‚¨é–‹å§‹èªªè©±æ™‚ï¼Œæ‡‰è©²çœ‹åˆ°ï¼š
- `ğŸ¤ Sending audio chunk: [æ•¸é‡] samples`
- `ğŸ“¤ Triggering response generation`

### 4. æª¢æŸ¥å›æ‡‰æ¥æ”¶

æ‡‰è©²çœ‹åˆ°ï¼š
- `ğŸ“¥ OpenAI response: response.audio_transcript.delta`
- `ğŸ“¥ OpenAI response: response.content.delta`

## å¸¸è¦‹å•é¡Œæ’æŸ¥

### å•é¡Œ 1: `server_error`

**ç—‡ç‹€**ï¼šé€£æ¥å¾Œç«‹å³æ”¶åˆ° `server_error`

**å¯èƒ½åŸå› **ï¼š
1. API key ç„¡æ•ˆæˆ–éæœŸ
2. API key æ²’æœ‰ Realtime API æ¬Šé™
3. æœƒè©±é…ç½®åƒæ•¸ä¸æ­£ç¢º
4. éŸ³è¨Šæ ¼å¼ä¸æ­£ç¢º

**è§£æ±ºæ­¥é©Ÿ**ï¼š
1. æª¢æŸ¥ API key æ˜¯å¦æ­£ç¢ºè¨­å®š
2. é©—è­‰ API key æ˜¯å¦æœ‰ Realtime API å­˜å–æ¬Šé™
3. æª¢æŸ¥å¾Œç«¯æ—¥èªŒä¸­çš„éŒ¯èª¤è©³æƒ…
4. å˜—è©¦ç°¡åŒ–æœƒè©±é…ç½®ï¼ˆç§»é™¤æŸäº›åƒæ•¸ï¼‰

### å•é¡Œ 2: WebSocket ç«‹å³é—œé–‰

**ç—‡ç‹€**ï¼šé€£æ¥æˆåŠŸå¾Œç«‹å³é—œé–‰ï¼ˆcode 1000ï¼‰

**å¯èƒ½åŸå› **ï¼š
1. èªè­‰å¤±æ•—
2. æœƒè©±é…ç½®éŒ¯èª¤
3. ä¼ºæœå™¨ç«¯éŒ¯èª¤

**è§£æ±ºæ­¥é©Ÿ**ï¼š
1. æª¢æŸ¥å¾Œç«¯æ—¥èªŒ
2. é©—è­‰ Authorization header æ˜¯å¦æ­£ç¢ºè¨­ç½®
3. æª¢æŸ¥ `OpenAI-Beta` header æ˜¯å¦æ­£ç¢º

### å•é¡Œ 3: æ²’æœ‰æ”¶åˆ°è½‰éŒ„æˆ–å›æ‡‰

**ç—‡ç‹€**ï¼šé€£æ¥æˆåŠŸï¼Œä½†æ²’æœ‰çœ‹åˆ°è½‰éŒ„æˆ– AI å›æ‡‰

**å¯èƒ½åŸå› **ï¼š
1. éŸ³è¨Šæ²’æœ‰æ­£ç¢ºç™¼é€
2. å›æ‡‰è§¸ç™¼æ™‚æ©Ÿä¸å°
3. UI æ›´æ–°é‚è¼¯æœ‰å•é¡Œ

**è§£æ±ºæ­¥é©Ÿ**ï¼š
1. æª¢æŸ¥æ˜¯å¦çœ‹åˆ° `ğŸ¤ Sending audio chunk` æ—¥èªŒ
2. æª¢æŸ¥æ˜¯å¦çœ‹åˆ° `ğŸ“¤ Triggering response generation` æ—¥èªŒ
3. æª¢æŸ¥æ˜¯å¦æ”¶åˆ° `response.audio_transcript.delta` è¨Šæ¯
4. æª¢æŸ¥ UI ç‹€æ…‹æ›´æ–°

## æ¸¬è©¦è…³æœ¬

ä½¿ç”¨æ¸¬è©¦è…³æœ¬é©—è­‰ API keyï¼š

```bash
npm run test:openai
```

é€™æœƒæ¸¬è©¦ï¼š
- API key æ˜¯å¦æœ‰æ•ˆ
- åŸºæœ¬ API å­˜å–
- Realtime API é€£æ¥

## ä¸‹ä¸€æ­¥èª¿è©¦

å¦‚æœå•é¡ŒæŒçºŒï¼š

1. **æª¢æŸ¥ OpenAI å®˜æ–¹æ–‡ä»¶**ï¼š
   - [OpenAI Realtime API æ–‡ä»¶](https://platform.openai.com/docs/guides/realtime)
   - æŸ¥çœ‹æœ€æ–°çš„ API è¦æ±‚å’Œç¯„ä¾‹

2. **æª¢æŸ¥ API ç‹€æ…‹**ï¼š
   - æŸ¥çœ‹ OpenAI ç‹€æ…‹é é¢
   - ç¢ºèª Realtime API æ˜¯å¦æ­£å¸¸é‹è¡Œ

3. **ç°¡åŒ–æ¸¬è©¦**ï¼š
   - å˜—è©¦åªç™¼é€æ–‡å­—è¨Šæ¯ï¼ˆä¸ä½¿ç”¨éŸ³è¨Šï¼‰
   - æ¸¬è©¦åŸºæœ¬çš„æœƒè©±å‰µå»º

4. **è¯ç¹«æ”¯æ´**ï¼š
   - å¦‚æœ API key æœ‰æ•ˆä½†ä»æœ‰å•é¡Œï¼Œå¯èƒ½éœ€è¦è¯ç¹« OpenAI æ”¯æ´

## æœ‰ç”¨çš„æ—¥èªŒç´šåˆ¥

åœ¨é–‹ç™¼æ™‚ï¼Œå¯ä»¥èª¿æ•´æ—¥èªŒè©³ç´°ç¨‹åº¦ï¼š

- **è©³ç´°æ¨¡å¼**ï¼šæ‰€æœ‰è¨Šæ¯éƒ½è¨˜éŒ„
- **æ­£å¸¸æ¨¡å¼**ï¼šåªè¨˜éŒ„é‡è¦äº‹ä»¶å’ŒéŒ¯èª¤
- **å®‰éœæ¨¡å¼**ï¼šåªè¨˜éŒ„éŒ¯èª¤

ç•¶å‰å¯¦ç¾ä½¿ç”¨è©³ç´°æ¨¡å¼ï¼Œæ–¹ä¾¿èª¿è©¦ã€‚

